---
title: Point Cloud Shading
layout: post
---


Data sets generated by range scanning systems (LiDAR, echosounder, etc.) can be readily displayed as point clouds. Points are usually colored by depth, range, quality or amplitude for easier interpretation. Point cloud rendering is straight-forward as we just need to load points in GPU vertex buffers and use a simple pixel shader for coloring. 

This simplicity comes with a drawback: compare to meshed model, point clouds tend to be more difficult to interpret due to incomplete depth perception. Varying point size based on eye distance helps enhance perspective, but small scale variations are usually hard to distinguish. Shading could help greatly here (think bump-mapping) but requires us to have a normal vector at each point.

Elevation data is often triangulated in the plane to compute normal vectors but this is not always practical. In our case, however, we may be able to take a short cut to estimate normal vectors.

In this application we use two multibeam echosounders to scan boats sailing overhead.  Each sonar generate a 2D-profile of {range, angles} points several times per second. 
![scan diagram]( /assets/images/hullsweep-diag.png)

The sensors are stationary but we measure the speed of the ship so we can stack the profiles over time and generate a 3D point cloud of the hull: 

![no shading]( /assets/images/hullsweep-snap-no-shading.png )


In this particular case, we perform a rudimentary triangulation by connecting neighboring points along and across the ship track directions. The normal vector at each points is then computed as the average of the normal vectors of the adjacent triangles.

We may then apply are simple diffuse light illumination model to shade the point cloud:

![no shading]( /assets/images/hullsweep-snap-with-shading.png )


This rudimentary point shading approach helps interpret the data in real-time without reconstructing a complete (mesh) model of the scene. 
Bumps on the hull of the vessel are often easier to spot as a result:

<table style="width:50%" >
<tr>
<td><img src="/assets/images/hullsweep-snap-no-shading-closeup.png"/></td>
<td><img src="/assets/images/hullsweep-snap-with-shading-closeup.png"/></td>
</tr>
</table>


  

     
    
 